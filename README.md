### 全国にある花の名所を探すことができる共有サイト「花ナビ」

[![Image from Gyazo](https://i.gyazo.com/e07a7005050d03e338c8bdcfe9a338d1.png)](https://gyazo.com/e07a7005050d03e338c8bdcfe9a338d1)

## サービス概要
「自然の中で花を楽しみたい！でも周りにどのようなスポットがあるのか分からない、、」<br>
こんな悩みを解決したい方の手助けになればと思い、作成しました！

## サービスURL

- AWS:  http://13.231.71.172
- heroku: https://hana-nav.herokuapp.com

## 環境

- 開発言語：ruby 2.7.2
- フレームワーク：Ruby on Rails 6.1.4
- HTMLテンプレートエンジン：Slim
- WEBフレームワーク：Bootstrap4
- CSS設計：BEM 
- DB：MariaDB 5.5.68
- Webサーバ：Nginx 1.20.0
- アプリケーションサーバー：Unicorn 5.4.1
- AWS(EC2, Elastic IP, S3)
- heroku(AWS:S3)
- 自動デプロイ：Capistrano
- バージョン管理：Git 2.31.1 

## ER図
[![Image from Gyazo](https://i.gyazo.com/991a2a06478a8109446748bdd7e3baa2.png)](https://gyazo.com/991a2a06478a8109446748bdd7e3baa2)

## 機能一覧

- 新規登録/ログイン/パスワード再設定機能(devise)
- 検索機能(ransack)
  - スポット検索 
  - ユーザー検索(ソート機能)
- 投稿機能
  - 画像投稿(carrierwave,rmagick,fog-aws)
    - プレビュー機能
  - インクリメンタルサーチ機能(タイムレス検索)
  - レビュー機能(raty)
- タイムライン機能
  - フォローユーザーの投稿を確認できる
- お気に入り機能(Ajax)
  - スポットの登録
- いいね機能(Ajax)
  - ユーザーの投稿に対して共感等の意思表現 
- フォロー機能(Ajax)
- ページネーション機能(kaminari)
- スポット所在地の地図表示(google maps API)

## 非機能一覧
- スクレイピング(nokogiri)->(app/models/scraping.rb)
  - スポットデータの取得
- バルクインサート(activerecord-import)->(lib/import_csv.rb)
  - CSVファイルのデータをDBに投入
- テスト(RSpec)

## 機能についての説明

### 新規投稿ページ（画像投稿）
- 最大3枚の画像を投稿できるようになっており、画像のアップロードと同時に非同期処理で画像投稿フォームを表示するようにしています。また、画像がちゃんと選択できたかひと目で分かるようプレビュー機能も搭載しています。

[![Image from Gyazo](https://i.gyazo.com/512e1b88a0f1c62b1630743d7d9cc5b5.gif)](https://gyazo.com/512e1b88a0f1c62b1630743d7d9cc5b5)

### インクリメンタルサーチ
- データベースに保存されているデータを対象に文字を入力するたびに即座に検索結果を表示するタイムレス検索機能です。

![4635318dc0d230da36ba06d6b026197b (2).gif](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/1131643/42eccf73-5000-49a6-4ed4-249f45d7f836.gif)

## 技術選定の基準
- Rubyはシンプルに書けて初心者向きの言語だと聞いており、転職活動で必要となるポートフォリオの作成に向いているのではないかと思い選びました。

- AWSを利用したインフラ構築が主流であることや、多くの企業が導入しているサービスに触れてみたいと感じ、使用しました。

## 工夫した点
- 複数の機能で非同期処理を活用したことや見た目にもこだわりながらレイアウト作成に取り組むなど、UI/UXともに力を入れて作成することができました。
- 花やスポットのデータがたくさん必要であったため、データ収集を大幅に効率化するためにスクレイピングを使用してCSVファイルに格納後、バルクインサートを使用してデータベースへ一括投入しています。

## 難しかった点
- インクリメンタルサーチ
  - 非同期処理に必要な Javascript が多数使用しているため、動作までの工程が複雑になり理解するのが難しかったです。
    - 改善策として処理全体の流れを可視化し、処理される順番通りに実装しながら進めることで理解を深めながら実装することができました。
- スクレイピング
  - 緯度・軽度を取得する際、URLに取得したい値が含まれていた為、`attributeメソッド`でhref属性値を取得しようと試みたがうまくいかなかった。
    - 改善策として正規表現を使用することで無事取得することができました。
